{% extends "qualtrics_link/base.html" %}

{% block title %}Qualtrics Status{% endblock %}
{% block pagetitle %}Qualtrics Status{% endblock %}

{% block stylesheet %}
{{ block.super }}

<style>
	.my-new-list { 
		display: normal; 
		float: right;
	}
	
	caption { 
		margin-bottom: 10px; 
		font-size: large; 
		font-weight: bold;
	}
	.caption {
		margin-bottom: 10px; 
		font-size: large; 
		font-weight: bold;
	}
	td {
		display: table-cell;
		word-break:break-word;
	}
	.title {
		text-align: center;
	}
	.spoof-form { width: 38%; }

</style>

{% endblock %}

{% block content %}

<h1>Qualtrics Internal Dashboard</h1>

<br />

<div class="well spoof-form">
<h4>Enter an HUID to spoof</h4>
<form action="internal" method="get" role="form">{% csrf_token %}
	{% for field in spoof_form %}
	{{ field.label_tag }}&nbsp;{{ field }}
	{% endfor %}
	<input type="submit" value="Submit" class="btn btn-default"/>
</form>
</div>


<br />

<table>
	<tr>
		<td valign="top">
			<table class="table table-striped table-hover">
			 	<caption>People Data</caption>
				<tr> <th>First name</th><td>{{person.name_first}}</td></tr>
				<tr> <th>Last name</th><td>{{person.name_last}}</td></tr>
				<tr> <th>Email</th><td>{{person.email_address}}</td></tr>
				<tr> <th>Role</th><td>{{person.role_type_cd}}</td></tr>
				<tr> <th>Department</th><td>{{person.department}}</td></tr>
				<tr> <th>School affiliations</th><td>{{processed_data.school_affiliations}}</td></tr>
				<tr> <th>ID</th><td>{{person.univ_id}}</td></tr>
			</table>
			<p><a href="{{ssotestlink}}" class="btn btn-primary">Qualtrics SSO test Link</a></p>
			<p><a href="{{qualtricslink}}" class="btn btn-primary">Qualtrics Survey Link</a></p>
		</td>
		<td valign="top">
			 <table class="table table-striped table-hover">
			 	<caption>Processed Data</caption>
			   	<tr> <th>user_id</th><td>{{huid}} </td></tr> 
			    <tr> <th>authenticated</th><td>{{request.user.is_authenticated}}</td></tr>
				<tr> <th>First name</th><td>{{processed_data.first_name}}</td></tr>
				<tr> <th>Last name</th><td>{{processed_data.last_name}}</td></tr>
				<tr> <th>Email</th><td>{{processed_data.email}}</td></tr>
				<tr> <th>Role</th><td>{{processed_data.role}}</td></tr>
				<tr> <th>Division</th><td>{{processed_data.division}}</td></tr>
				<tr> <th>ID</th><td>{{processed_data.id}}</td></tr>
				<tr> <th>Valid School</th><td>{{processed_data.valid_school}}</td></tr>
				<tr> <th>Valid Dept</th><td>{{processed_data.valid_dept}}</td></tr>
			    <tr><th>user_in_whitelist</th><td>{{user_in_whitelist}}</td></tr>
			</table>
		</td>
		<td valign="top" id="data">
		</td>
	</tr>
</table>


<form action="internal" method="POST">{% csrf_token %}
    <label for="division">Division: </label>
    <input id="division" type="text" name="division">
	{{ qualtrics_user_update_form.division }}

	<label for="role">Role: </label>
    <input id="role" type="text" name="manually_updated">
	{{ qualtrics_user_update_form.role }}

	<label for="manually_updated">Manually updated: </label>
    <input id="manually_updated" type="text" name="manually_updated">
	{{ qualtrics_user_update_form.manually_updated }}

    <input type="submit" value="Submit">
</form>


{% endblock %}

{% block javascript %}
{{ block.super }}

<script type="text/javascript">

$(document).ready(function() {
	$.getJSON( "get_org_info.json", function( data ) {
	
		var items = [];
		items.push('<caption>Qualtrics API Data</caption>');
		items.push('<tr><th colspan=2 class="alert alert-info">getResponseCountsByOrganization</th></tr>')
		$.each( data.org_info[0].getResponseCountsByOrganization.Result, function( key, val ) {
		    	items.push( "<tr><th>" + key + "</th><td>" + val + "</td></tr>" );
		  	});

		items.push('<tr><th colspan=2 class="alert alert-info">getOrgActivity</th></tr>')
		$.each( data.org_info[1].getOrgActivity.Result, function( key, val ) {
			$.each( val, function(tkey, value) {
		    	items.push( "<tr><th>" + tkey + "</th><td>" + value + "</td></tr>" );
		    });
		});

		$( "<table/>", {
		"class": "table table-striped table-hover",
		html: items.join( "" )
		}).appendTo( "#data" );

	});
});
</script>

{% endblock %}
